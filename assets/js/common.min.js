!function(e){function r(){return window.FormulaParser&&window.FormulaParser.Parser?window.FormulaParser.Parser:window.formulaParser&&window.formulaParser.Parser?window.formulaParser.Parser:null}const t="function"==typeof e.number;window.mnsNavasanPlusFunctions={numberToPersian(e){const r={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"};return String(e).replace(/[0-9]/g,e=>r[e])},maybePersian(e){return document&&document.documentElement&&"rtl"===document.documentElement.dir?this.numberToPersian(e):e},moveUp(e){e.previousElementSibling&&e.parentNode.insertBefore(e,e.previousElementSibling)},moveDown(e){e.nextElementSibling&&e.parentNode.insertBefore(e.nextElementSibling,e)},generateRandomHEX(){let e="#";for(let r=0;r<6;r++)e+="0123456789ABCDEF"[16*Math.random()|0];return e},precision(e){if(e=Number(e),!isFinite(e))return 0;let r=1,t=0;for(;t<12&&Math.round(e*r)/r!==e;)r*=10,t++;return t},trailingZeroDecimal:e=>(e=Math.abs(Number(e)),!isFinite(e)||0===e||e>=1?0:Math.max(0,Math.floor(-Math.log10(e)))),numberLength:e=>0===(e=Math.abs(parseInt(e))||0)?1:1+(0|Math.log10(e)),dynamicDecimal(e){if(0===(e=Math.abs(Number(e))||0))return 2;const r=this.numberLength(e);return e>=1?Math.max(0,4-r):Math.min(8,this.trailingZeroDecimal(e)+3)},formatNumbers(r,n=null,a=".",o=","){const s=Number(r),i=null===n?Number.isInteger(s)?0:this.dynamicDecimal(s):n;if(t)return e.number(s,i,a,o);try{return new Intl.NumberFormat(void 0,{minimumFractionDigits:i,maximumFractionDigits:i}).format(s)}catch(e){return s.toFixed(i)}},operationNumber(e,r="none"){switch(r){case"invert":return 1/e;case"radical_2":return Math.sqrt(e);case"divide_10":return e/10;default:return e}},roundNumber(e,r=0,t="zero",n="close"){if(!r)return e;switch(t){case"zero":"close"===n&&(e=r*Math.round(e/r)),"up"===n&&(e=r*Math.ceil(e/r)),"down"===n&&(e=r*Math.floor(e/r));break;case"nine":"close"===n&&(e=10*r*Math.round(e/(10*r))-1),"up"===n&&(e=10*r*Math.ceil(e/(10*r))-1),"down"===n&&(e=10*r*Math.floor(e/(10*r))-1);break;case"hybrid":"close"===n&&(e=10*r*Math.round(e/(10*r))-r),"up"===n&&(e=10*r*Math.ceil(e/(10*r))-r),"down"===n&&(e=10*r*Math.floor(e/(10*r))-r)}return e},prepareFormulaComponent(e,r){const t=(r=(r||"").toString()).match(/{[A-Za-z0-9-]+}/g);return t?(t.forEach(t=>{const n=t.slice(1,-1),[a,o]=n.split("-"),s=e.find(`.variable-${o}`),i=parseFloat(s.data("rate"))||1,u=parseFloat(s.find("input").val())||parseFloat(s.find("input").attr("placeholder"))||0;let l=i*u;"u"===a&&(l=i),"v"===a&&(l=u),r=r.replace(t,l)}),r):r},prepareFormula(e){const r=e.find(".mns-navasan-plus-text"),t=r.length&&r.val()||"";return this.prepareFormulaComponent(e,t.trim())},runFormula(e){const t=r(),n=e.find(".mns-navasan-plus-result"),a=this.prepareFormula(e);if(!t)return console.warn("[MNSNP] Parser not found"),n.text(this.formatNumbers(0)),0;const o=new t;o.parse(a);const s=!o.error&&a.length?Math.max(0,o.result):0;return n.text(this.formatNumbers(s)),s},calculateFormulaComponent(e,t){const n=r();if(!n)return 0;const a=new n;return a.parse(this.prepareFormulaComponent(e,t)),!a.error&&t&&t.length?Math.max(0,a.result):0},applyMargin(e,r=0,t="percent",n=1){if(e=Number(e),"percent"===t){return e*(Math.max(-100,Number(r))/100+1)}return"fixed"===t?e+Math.max(0,Number(r))/(n||1):e},calculateRateNumber(e,r,t,n,a,o,s){let i=this.applyMargin(Number(e),o,s,Number(r));return i*=Number(r),this.roundNumber(i,Number(t)||0,String(n||"zero"),String(a||"close"))},calculateRatePrice(e,r,t,n,a,o,s){const i=this.calculateRateNumber(e,r,t,n,a,o,s);return i<0?0:i},async restRequest(e,r={}){const t=window.mnsNavasanPlusGlobal||{};let n=(t.restBase||"/wp-json/mnsnp/v1/").replace(/\/+$/,"")+"/"+String(e||"").replace(/^\/+/,"");t.token&&(n+=(n.includes("?")?"&":"?")+"token="+encodeURIComponent(t.token));const a=await fetch(n,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json",...t.restNonce?{"X-WP-Nonce":t.restNonce}:{}},body:JSON.stringify(r)}),o=await a.json().catch(()=>({}));if(!a.ok||o&&o.code&&o.message)throw o||{message:"REST error"};return o},async sendRequest(e,r={}){const t=window.mnsNavasanPlusGlobal||{},n=await fetch(t.ajaxUrl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:e,...r})}),a=await n.json().catch(()=>({}));if(!a||!0!==a.success)throw a&&a.data||{message:"AJAX error"};return a.data}}}(jQuery);