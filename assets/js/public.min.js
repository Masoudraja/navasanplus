/*!
 * MNS Navasan Plus — public.js
 * Helper utilities + optional binders for front-end widgets:
 *  - Formula Calculator  (.mns-formula-calculator)
 *  - Formula Order       (form.mns-formula-order)
 *  - Price Calculator    (.mns-price-calculator)
 *  - Rate Converter      (.mns-rate-converter)
 *
 * NOTE: This file does NOT auto-bind handlers to avoid double-binding with any inline scripts.
 *       Use the exported binders if you want JS-only wiring:
 *         MNSNavasanPlus.bindFormulaCalculator(el)
 *         MNSNavasanPlus.bindFormulaOrder(form, { expression: '...', onResult: fn })
 *         MNSNavasanPlus.bindPriceCalculator(el)
 *         MNSNavasanPlus.bindRateConverter(el)
 *
 * Dependencies:
 *   - window.FormulaParser (provided by assets/js/formula-parser.js)
 */
!function(e,t){"use strict";function n(e,n){return(e||t).querySelector(n)}function r(e){var t=Number(e);return isNaN(t)?0:t}function a(e,t=2,n=2){try{return Number(e).toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:n})}catch(t){return String(e)}}function u(e){var n,a,u={};return(n=e,a="input[data-code], select[data-code], textarea[data-code]",Array.prototype.slice.call((n||t).querySelectorAll(a))).forEach(function(e){var t=e.getAttribute("data-code");t&&(u[t]=r(e.value||e.getAttribute("placeholder")||0))}),u}function o(t,n){return e.FormulaParser&&e.FormulaParser.Parser?(new e.FormulaParser.Parser).evaluate(t,n||{}):NaN}function c(e,t,n,r){if(r=r||"close",(t=Number(t)||0)<=0)return e;var a=1/t;return"integer"===(n=n||"zero")?Math.round(e):("close"===r?Math.round:"up"===r?Math.ceil:Math.floor)(e*a)/a}e.MNSNavasanPlus=e.MNSNavasanPlus||{},e.MNSNavasanPlus.utils={fmt:a,evaluateFormula:o,roundValue:c,getInputVars:u},e.MNSNavasanPlus.bindFormulaCalculator=function(e){if(e&&!e.__mnsnpBound){e.__mnsnpBound=!0;var t=e.getAttribute("data-formula")||"",r=n(e,".mns-formula-calc-btn"),c=n(e,".mns-formula-result-value");r&&c&&r.addEventListener("click",function(n){n.preventDefault();var r=u(e),i=o(t,r);c.textContent=isNaN(i)?"—":a(i,2,2)})}},e.MNSNavasanPlus.bindFormulaOrder=function(t,r){if(t&&!t.__mnsnpBound){t.__mnsnpBound=!0;var i=n(t,".mns-formula-calc-btn"),l=n(t,".mns-formula-result-value"),s=function(e,t){try{var n=e.getAttribute(t);return n?JSON.parse(n):null}catch(e){return null}}(t,"data-options")||{},d=Object.assign({round:[0,"zero","up"],min:0,redirect:"none"},s,r||{}),m=0,v="zero",f="up";Array.isArray(d.round)?(m=Number(d.round[0])||0,v=d.round[1]||"zero",f=d.round[2]||"up"):d.round&&"object"==typeof d.round&&(m=Number(d.round.step)||0,v=d.round.type||"zero",f=d.round.side||"up"),i&&i.addEventListener("click",function(n){n.preventDefault();var r=u(t),i=o(d.expression||t.getAttribute("data-expression")||"",r);if(isNaN(i)&&(i=0),i=c(i,m,v,f),d.min&&i<Number(d.min)&&(i=Number(d.min)),l&&(l.textContent=a(i,2,2)),"function"==typeof d.onResult)try{d.onResult(i)}catch(e){}d.redirect&&"none"!==d.redirect&&(e.location.href=d.redirect+(d.redirect.indexOf("?")>-1?"&":"?")+"price="+encodeURIComponent(i))})}},e.MNSNavasanPlus.bindPriceCalculator=function(e){if(e&&!e.__mnsnpBound){e.__mnsnpBound=!0;var t=n(e,".mns-price-calculator-amount"),u=n(e,".mns-price-calculator-currency-select"),o=n(e,".mns-price-calculator-btn"),c=n(e,".mns-price-calculator-result-value");t&&u&&o&&c&&o.addEventListener("click",function(e){e.preventDefault();var n=r(t.value),o=r(u.value),i=(u.options[u.selectedIndex]||{}).getAttribute("data-symbol")||"",l=n*o;c.textContent=a(l,2,2)+(i?" "+i:"")})}},e.MNSNavasanPlus.bindRateConverter=function(e){if(e&&!e.__mnsnpBound){e.__mnsnpBound=!0;var t=n(e,".mns-rate-converter-amount"),u=n(e,".mns-rate-converter-from"),o=n(e,".mns-rate-converter-to"),c=n(e,".mns-rate-converter-btn"),i=n(e,".mns-rate-converter-result-value");t&&u&&o&&c&&i&&c.addEventListener("click",function(e){e.preventDefault();var n=r(t.value),c=r(u.value),l=r(o.value),s=(o.options[o.selectedIndex]||{}).getAttribute("data-symbol")||"",d=c>0&&l>0?n*(c/l):0;i.textContent=a(d,2,2)+(s?" "+s:"")})}}}(window,document);