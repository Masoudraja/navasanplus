!function(e){"use strict";const n=window.Swiper||null,s=window.gsap||null;void 0===window.mnsBannerDebug&&(window.mnsBannerDebug=!1);const i=window.mnsCurrencyBanner||{};window.MNSCurrencyBannerModern={instances:new Map,init:function(){const n=window.MNSCurrencyBannerModern,s=e(".mns-currency-banner-modern");window.mnsBannerDebug&&console.log("[MNS Modern Banner] Global init() - Found",s.length,"banners"),s.each(function(s){const i=e(this).attr("id");if(window.mnsBannerDebug&&console.log("[MNS Modern Banner] Processing banner",s+1,"ID:",i),i&&!n.instances.has(i)){window.mnsBannerDebug&&console.log("[MNS Modern Banner] Creating new instance for:",i);const e=new t(this);n.instances.set(i,e)}else i&&n.instances.has(i)?window.mnsBannerDebug&&console.log("[MNS Modern Banner] Instance already exists for:",i):window.mnsBannerDebug&&console.log("[MNS Modern Banner] Warning: Banner has no ID, skipping")}),window.mnsBannerDebug&&console.log("[MNS Modern Banner] Total active instances:",n.instances.size)},refresh:function(e=null){const n=window.MNSCurrencyBannerModern;if(e){const s=n.instances.get(e);s&&s.refreshRates()}else n.instances.forEach(e=>{e.refreshRates()})},destroy:function(e=null){const n=window.MNSCurrencyBannerModern;if(e){const s=n.instances.get(e);s&&(s.destroy(),n.instances.delete(e))}else n.instances.forEach(e=>{e.destroy()}),n.instances.clear()}};class t{constructor(n){this.banner=e(n),this.bannerId=this.banner.attr("id"),this.currencyIds=this.getCurrencyIds(),this.autoRefreshInterval=parseInt(this.banner.data("auto-refresh"))||0,this.showChange="yes"===this.banner.data("show-change"),this.showTime="yes"===this.banner.data("show-time"),this.showSymbol="yes"===this.banner.data("show-symbol"),this.animationType=this.banner.data("animation")||"slide",this.refreshTimer=null,this.lastRates={},this.isLoading=!1,this.resizeTimer=null,this.swiperInstance=null,this.isInWoodmartHeader=this.banner.closest(".woodmart-header-banner").length>0,this.boundHandleVisibilityChange=this.handleVisibilityChange.bind(this),this.boundHandleWindowFocus=this.handleWindowFocus.bind(this),this.boundHandleWindowBlur=this.handleWindowBlur.bind(this),this.init()}init(){window.mnsBannerDebug&&console.log("[MNS Modern Banner] Instance init() called for:",this.bannerId),this.setupEventListeners(),this.startAutoRefresh(),this.storeCurrentRates(),setTimeout(()=>{this.initAnimations()},100)}initAnimations(){const i=e(window).width(),t=this.getAnimationType();window.mnsBannerDebug&&console.log("[MNS Modern Banner] Init animations for:",t,"width:",i);let r=t;if(i<=576){r=this.banner.data("mobile-animation")||"ticker"}else i<=768&&(r=this.banner.data("tablet-animation")||"grid");this.isInWoodmartHeader&&("ticker"!==r&&"carousel"!==r||(r="ticker")),"ticker"===r?this.initTickerSwiper():"carousel"===r&&n?this.initCarouselSwiper():"slide"===r&&s?this.animateWithGSAP("slide"):"fade"===r&&s?this.animateWithGSAP("fade"):this.animateWithCSS(r)}initTickerSwiper(){if(!n)return window.mnsBannerDebug&&console.warn("[MNS Modern Banner] Swiper not available for ticker, falling back to CSS carousel"),void this.animateWithCSS("carousel");const s=this.banner.find(".mns-banner-container-modern"),i=s.find(".mns-currency-item-modern"),t=i.length;if(0===t)return;const r=i.map(function(){return'<div class="swiper-slide">'+this.outerHTML+"</div>"}).get().join("");s.html(`<div class="swiper-wrapper">${r}</div>`),s.addClass("swiper-container mns-ticker-swiper"),setTimeout(()=>{const i=s.width();let r=0;if(s.find(".swiper-slide").each(function(){r+=e(this).outerWidth(!0)}),r<=i&&t<=3)return window.mnsBannerDebug&&console.log("[MNS Modern Banner] Ticker not needed, content fits within the container."),void s.find(".swiper-wrapper").css({"justify-content":"center",display:"flex"});this.swiperInstance=new n(s[0],{loop:!0,slidesPerView:"auto",spaceBetween:16,centeredSlides:!1,speed:5e3,freeMode:!0,autoplay:{delay:0,disableOnInteraction:!1,pauseOnMouseEnter:!1},allowTouchMove:!0,grabCursor:!0,loopAdditionalSlides:2,loopedSlides:t}),window.mnsBannerDebug&&console.log("[MNS Modern Banner] Ticker Swiper configured:",{itemCount:t,totalWidth:r,speed:this.swiperInstance.params.speed})},50)}initCarouselSwiper(){if(!n)return window.mnsBannerDebug&&console.warn("[MNS Modern Banner] Swiper not available, falling back to CSS carousel"),void this.animateWithCSS("carousel");const e=this.banner.find(".mns-banner-container-modern"),s=e.find(".mns-currency-item-modern"),i=s.length;if(0===i)return;const t=s.map(function(){return'<div class="swiper-slide">'+this.outerHTML+"</div>"}).get().join(""),r=this.bannerId+"-swiper";e.html(`<div class="swiper mns-swiper-container" id="${r}">\n          <div class="swiper-wrapper">${t}</div>\n          <div class="swiper-button-next"></div>\n          <div class="swiper-button-prev"></div>\n          <div class="swiper-pagination"></div>\n        </div>`);const a=e.width()||500,o=Math.max(1,Math.floor(a/150)),d=Math.min(o,i||1);this.swiperInstance=new n(e.find(".swiper")[0],{slidesPerView:1,spaceBetween:10,loop:i>d,autoplay:{delay:3e3,disableOnInteraction:!1,pauseOnMouseEnter:!0},speed:600,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0,type:"bullets"},breakpoints:{320:{slidesPerView:Math.min(1.5,d),spaceBetween:8},480:{slidesPerView:Math.min(2.5,d),spaceBetween:10},768:{slidesPerView:Math.min(3.5,d),spaceBetween:12},1024:{slidesPerView:Math.min(4.5,d),spaceBetween:15}}}),window.mnsBannerDebug&&console.log("[MNS Modern Banner] Carousel Swiper initialized. Items:",i)}animateWithGSAP(e){if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return void this.banner.find(".mns-currency-item-modern").css("opacity",1);if(!s)return window.mnsBannerDebug&&console.warn("[MNS Modern Banner] GSAP not available, falling back to CSS animations"),void this.animateWithCSS(e);const n=this.banner.find(".mns-currency-item-modern");"slide"===e?s.fromTo(n.toArray(),{x:20,opacity:0},{x:0,opacity:1,duration:.5,stagger:.1,ease:"power2.out"}):"fade"===e&&s.fromTo(n.toArray(),{opacity:0},{opacity:1,duration:.8,stagger:.1,ease:"power2.out"})}animateWithCSS(n){const s=this.banner.find(".mns-currency-item-modern"),i=this.banner.find(".mns-banner-container-modern");"slide"===n||"fade"===n?s.each(function(n){setTimeout(()=>{e(this).addClass("mns-animate-in-modern")},100*n)}):"carousel"===n?(i.css({"overflow-x":"auto","flex-wrap":"nowrap","scroll-behavior":"smooth"}),this.enhanceScrolling(i)):"grid"===n&&i.css({"overflow-x":"hidden","flex-wrap":"wrap"})}enhanceScrolling(e){let n,s,i=!1;e[0].scrollWidth>e[0].clientWidth&&this.banner.addClass("has-overflow");let t=!1;e.on("scroll",()=>{t||(t=!0,this.banner.addClass("scrolled"));const n=e.scrollLeft(),s=e[0].scrollWidth;n+e[0].clientWidth>=s-10?this.banner.addClass("scroll-end"):this.banner.removeClass("scroll-end")}),e.on("touchmove",()=>{t||(t=!0,this.banner.addClass("scrolled"))}),e.on("mousedown",t=>{i=!0,n=t.pageX-e.offset().left,s=e.scrollLeft()}),e.on("mouseleave",()=>{i=!1}),e.on("mouseup",()=>{i=!1}),e.on("mousemove",t=>{if(!i)return;t.preventDefault();const r=2*(t.pageX-e.offset().left-n);e.scrollLeft(s-r)}),this.addScrollIndicators(e)}addScrollIndicators(e){if(this.banner.find(".mns-scroll-indicator").remove(),e[0].scrollWidth>e[0].clientWidth){const n='\n          <div class="mns-scroll-indicator mns-scroll-left">‹</div>\n          <div class="mns-scroll-indicator mns-scroll-right">›</div>\n        ';this.banner.append(n);const s=this.banner.find(".mns-scroll-left"),i=this.banner.find(".mns-scroll-right"),t=()=>{const n=e.scrollLeft(),t=e[0].scrollWidth,r=e[0].clientWidth;s.toggleClass("visible",n>10),i.toggleClass("visible",n<t-r-10)};t(),e.on("scroll",t),s.on("click",()=>{e.animate({scrollLeft:"-=150"},300)}),i.on("click",()=>{e.animate({scrollLeft:"+=150"},300)})}}getCurrencyIds(){const n=[];return this.banner.find(".mns-currency-item-modern:not(.cloned)").each(function(){const s=e(this).data("currency-id");s&&String(s).trim()&&n.push(s)}),n}setupEventListeners(){this.banner.on("mouseenter",".mns-currency-item-modern",this.handleItemHover.bind(this)),this.banner.on("mouseleave",".mns-currency-item-modern",this.handleItemLeave.bind(this)),void 0!==document.hidden&&document.addEventListener("visibilitychange",this.boundHandleVisibilityChange),e(window).on("focus",this.boundHandleWindowFocus),e(window).on("blur",this.boundHandleWindowBlur),e(window).on("resize",()=>{clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(()=>{this.handleResize()},250)})}handleResize(){this.swiperInstance&&(this.swiperInstance.destroy(!0,!0),this.swiperInstance=null),this.banner.find(".mns-currency-item-modern.cloned").remove(),setTimeout(()=>{this.initAnimations()},100)}handleItemHover(n){e(n.currentTarget).addClass("mns-item-hover-modern")}handleItemLeave(n){e(n.currentTarget).removeClass("mns-item-hover-modern")}handleVisibilityChange(){document.hidden?this.pauseAutoRefresh():this.resumeAutoRefresh()}handleWindowFocus(){this.resumeAutoRefresh()}handleWindowBlur(){this.pauseAutoRefresh()}getAnimationType(){return this.banner.data("animation")||"slide"}startAutoRefresh(){this.autoRefreshInterval>0&&(this.refreshTimer=setInterval(()=>{this.refreshRates()},1e3*this.autoRefreshInterval))}pauseAutoRefresh(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}resumeAutoRefresh(){this.autoRefreshInterval>0&&!this.refreshTimer&&this.startAutoRefresh()}storeCurrentRates(){this.banner.find(".mns-currency-item-modern:not(.cloned)").each((n,s)=>{const i=e(s),t=i.data("currency-id"),r=i.find(".mns-price-value-modern").data("rate");t&&void 0!==r&&(this.lastRates[t]=r)})}refreshRates(){if(this.isLoading||0===this.currencyIds.length)return;this.isLoading=!0,this.banner.addClass("loading");let n=void 0!==i&&i.ajaxUrl?i.ajaxUrl:void 0!==window.ajaxurl?window.ajaxurl:"/wp-admin/admin-ajax.php";if(0!==n.indexOf("http")){const e=n.replace(/^\/+/,"");n=window.location.origin+"/"+e}const s=void 0!==i&&i.nonce?i.nonce:void 0!==window.mnsCurrencyBanner&&window.mnsCurrencyBanner.nonce?window.mnsCurrencyBanner.nonce:"",t={action:"mns_get_currency_rates",currency_ids:this.currencyIds.join(","),nonce:s,security:s};window.mnsBannerDebug&&(console.log("[MNS Modern Banner] Refreshing rates for currencies:",this.currencyIds),console.log("[MNS Modern Banner] AJAX URL:",n),console.log("[MNS Modern Banner] Data:",t));const r=this,a=s=>e.ajax({url:n,type:s,data:t,dataType:"json",timeout:15e3});a("POST").done(e=>{r.handleAjaxSuccess(e)}).fail(()=>{a("GET").done(e=>{r.handleAjaxSuccess(e)}).fail((e,s,i)=>{r.handleAjaxError(e,s,i,n,t)})})}handleAjaxSuccess(e){window.mnsBannerDebug&&console.log("[MNS Modern Banner] AJAX response:",e),e.success&&e.data&&e.data.rates?(this.updateRates(e.data.rates),this.showTime&&e.data.timestamp&&this.updateTimestamp(e.data.timestamp)):console.warn("[MNS Modern Banner] Failed to refresh rates:",e),this.isLoading=!1,this.banner.removeClass("loading")}handleAjaxError(e,n,s,t,r){window.mnsBannerDebug&&(console.error("[MNS Modern Banner] AJAX request failed:",n,s,"URL:",t,"Data:",r),console.error("[MNS Modern Banner] Response:",e.responseText)),this.banner.find(".mns-banner-timestamp-modern").html('<span class="mns-error-message-modern">'+(void 0!==i&&i.i18n&&i.i18n.error?i.i18n.error:"Error loading rates")+"</span>"),this.isLoading=!1,this.banner.removeClass("loading"),this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)}updateRates(n){this.banner.find(".mns-currency-item-modern:not(.cloned)").each(function(){const s=e(this),i=s.data("currency-id"),t=n[i];if(t){const e=s.find(".mns-price-value-modern"),n=parseFloat(t.rate)||0,i=parseFloat(n).toLocaleString("en-US",{maximumFractionDigits:0});if(e.data("rate",n).text(i),void 0!==t.change_pct){const e=s.find(".mns-price-change-modern"),n=parseFloat(t.change_pct),i=(n>0?"+":"")+n.toFixed(2)+"%";e.find(".mns-change-value-modern").text(i),e.removeClass("mns-change-positive-modern mns-change-negative-modern mns-change-neutral-modern"),n>0?e.addClass("mns-change-positive-modern"):n<0?e.addClass("mns-change-negative-modern"):e.addClass("mns-change-neutral-modern")}s.addClass("mns-price-updated-modern"),setTimeout(()=>{s.removeClass("mns-price-updated-modern")},1e3)}}),Object.keys(n).forEach(e=>{void 0!==n[e].rate&&(this.lastRates[e]=n[e].rate)})}updateTimestamp(e){this.banner.find(".mns-time-value-modern").text(e)}destroy(){this.refreshTimer&&clearInterval(this.refreshTimer),this.swiperInstance&&this.swiperInstance.destroy(!0,!0),document.removeEventListener("visibilitychange",this.boundHandleVisibilityChange),e(window).off("focus",this.boundHandleWindowFocus),e(window).off("blur",this.boundHandleWindowBlur),e(window).off("resize",this.handleResize),this.banner.off("mouseenter",".mns-currency-item-modern"),this.banner.off("mouseleave",".mns-currency-item-modern"),this.bannerId&&window.MNSCurrencyBannerModern.instances.delete(this.bannerId),window.mnsBannerDebug&&console.log("[MNS Modern Banner] Instance destroyed:",this.bannerId)}}e(document).ready(function(){window.MNSCurrencyBannerModern.init()}),e(document).on("mns_banner_init",function(){window.MNSCurrencyBannerModern.init()})}(jQuery);